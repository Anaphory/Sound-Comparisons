AudioLogic=Backbone.View.extend({initialize:function(){this.playing=false;this.current=null;this.hoverDelay=100;this.timeoutId=null;this.playFinished=null;var a=this;$(".audio").each(function(c){var b=$("audio",this).get(0);$(this).on("click mouseover mouseout touchstart",function(g){switch(g.type){case"mouseover":a.mouseOver(b);break;case"mouseout":a.mouseOut(b);break;case"click":case"touchstart":default:a.play(b)}})})},mouseOver:function(b){if(!window.App.soundPlayOption.playOnHover()){return}var a=this;this.timeoutId=window.setTimeout(function(){a.play(b);a.timeoutId=null},this.hoverDelay)},mouseOut:function(a){if(this.timeoutId){window.clearTimeout(this.timeoutId);this.timeoutId=null}},play:function(b){if(!b){if(f=this.playFinished){f()}return}if(this.current){this.stop()}this.current=b;this.onDemand(b);var a=this;$(b).unbind("ended").on("ended",function(){a.played(b)});if(0==$("source",b).length){this.played(b);return}this.playing=true;this.markPlaying(b);b.play();this.log(b)},stop:function(){this.playing=false;if(this.current){this.current.pause();this.current.currentTime=0;this.markNotPlaying(this.current)}this.current=null},played:function(a){this.playing=false;this.markNotPlaying(a);this.current=null;if(f=this.playFinished){f()}},markPlaying:function(a){$(a).parent().find(".transcription").addClass("playing")},markNotPlaying:function(a){$(a).parent().find(".transcription").removeClass("playing")},onDemand:function(a){if(d=$(a).attr("data-onDemand")){var b="";$($.parseJSON(d)).each(function(c,e){b=b+"<source src='"+e+"'></source>"});$(a).attr("onDemand","").html(b);a.load()}},setPlayFinished:function(a){this.playFinished=a},log:function(b){if(!_gaq){return}var c=$("source",b).attr("src");var a=/.*sound\/(.*)\.(ogg|mp3)/;if(a.test(c)){c=a.exec(c)[1];_gaq.push(["_trackEvent","Transcription","Hoverplay",c])}}});function initLoad(){var b=/.*pageView=([^&]*).*/;var c=$("div#saveLocation").attr("href");var a="load_"+b.exec(c)[1];$.cookie(a,c);$("a[load]").click(function(g){var h="load_"+$(this).attr("load");var i=$.cookie(h);if(i===null){i=$(this).attr("href")}var d=/.*study=([^&]*).*/;var e=d.exec(window.location.href)[1];var f=d.exec(i)[1];if(f==e){g.preventDefault();window.location.href=i}})};function initIpaKeyboard(){var e=function(){$(".ipaButtonAct").removeClass("ipaButtonAct").addClass("ipaButtonInAct");$("#ipaKeyboard .fadeIn").removeClass("fadeIn").addClass("fadeOut")};var b=$("#ipaKeyboard");var a=function(){var h=(window.innerWidth-b.width())/2;var g=(window.innerHeight-b.height())/2;b.css("margin-left",h+"px").css("margin-top",g+"px")};var c=$("#IPAOpenKeyboard");var f=function(){if(b.is(":visible")){c.trigger("click")}};c.toggle(function(){b.show();a()},function(){b.hide()});$("#ipaClose, #contentArea, #leftMenu").click(f);$(document).keyup(function(g){if(g.keyCode==27){f()}});$("#PhoneticFilter").keyup(function(g){if(g.keyCode==13){f()}});$("#ipaButtonVowels").click(function(){e();$(this).removeClass("ipaButtonInAct").addClass("ipaButtonAct");$("#ipaVowels").removeClass("fadeOut").addClass("fadeIn");a()});$("#ipaButtonConsonants").click(function(){e();$(this).removeClass("ipaButtonInAct").addClass("ipaButtonAct");$("#ipaConsonants").removeClass("fadeOut").addClass("fadeIn");a()});$("#ipaButtonOthers").click(function(){e();$(this).removeClass("ipaButtonInAct").addClass("ipaButtonAct");$("#ipaOthers").removeClass("fadeOut").addClass("fadeIn");a()});$("#ipaButtonTone").click(function(){e();$(this).removeClass("ipaButtonInact").addClass("ipaButtonAct");$("#ipaTone").removeClass("fadeOut").addClass("fadeIn");a()});var d=function(k){var g=$("#PhoneticFilter");var j=g.get(0);var l=j.ownerDocument;if(l.selection){j.focus();sel=l.selection.createRange();sel.text=k}else{if(j.selectionStart||j.selectionStart=="0"){var i=j.selectionStart;var h=j.selectionEnd;j.value=j.value.substring(0,i)+k+j.value.substring(h,j.value.length)}else{j.value+=k}}g.keyup()};$("#ipaKeyboard td[unicode]").click(function(){var g=$(this).attr("unicode");if(g==null||g==""){return}d(g)}).mouseout(function(){$("#keyboardFooter").text("")}).mouseover(function(){var g=$(this).attr("description");$("#keyboardFooter").text(g)})};function initScroll(){var c=function(){$("div.scrollDown").each(function(){var f=$(this).prev();var e=$.scrollTo.max(f[0]);var d=f.scrollTop();if(e<=d){$(this).hide()}else{$(this).show()}})};var a=function(){$("div.scrollUp").each(function(){var e=$(this).next();var d=e.scrollTop();if(d<=0){$(this).hide()}else{$(this).show()}})};var b=function(){a();c()};$("div.scrollDown").click(function(){var d=$(this).prev();d.prev().show();d.scrollTo("+=500px",800,{onAfter:c})});$("div.scrollUp").click(function(){var d=$(this).next();d.next().show();d.scrollTo("-=500px",800,{onAfter:a})});$("div.scrollUp").next().bind("mousewheel",function(e,f){var d=$(this);if(f>0){d.scrollTo("-=50px",0,{onAfter:b})}else{d.scrollTo("+=50px",0,{onAfter:b})}});b()};WordOverlay=Backbone.Model.extend({defaults:{content:"",color:"#000000",div:null,edge:"sw",hoverText:"",id:-1,marker:null,position:null,added:false,view:null},initialize:function(){var a={id:_.uniqueId("WordOverlay_"),position:new google.maps.LatLng(this.get("lat"),this.get("lon")),hoverText:this.get("langName"),content:""};_.each(this.get("phoneticSoundfiles"),function(c){var b="";if(c.soundfiles.length>0){b="<audio data-onDemand='"+JSON.stringify(c.soundfiles)+"' autobuffer='' preload='auto'></audio>"}var d="";if(this.get("historical")==1||b===""){d=" fileMissing"}if(this.get("historical")==1){c.phonetic="*"+c.phonetic}if(a.content!==""){a.content+=","}a.content+="<div class='transcription"+d+"'>"+c.phonetic+"</div>"+b},this);this.set(a)},validate:function(b,a){if(b.color){if(!/^#[0123456789abcdef]{6}$/i.test(b.color)){return"Invalid color: "+b.color}}if(b.edge){if(!/^[ns][we]$/.test(b.edge)){return"Invalid edge: "+b.edge}}},getAudio:function(){var a=this.get("div");return a?$("audio",a).get(0):null},getDistance:function(a){var c=this.get("position"),b=a.get("position");return google.maps.geometry.spherical.computeDistanceBetween(c,b)},equals:function(a){return this.get("id")===a.get("id")},getBBox:function(a){var b=this.get("view").getPoint(),d=$(this.get("div")),a=a||this.get("edge"),c={x1:b.x,y1:b.y,x2:b.x+d.width(),y2:b.y+d.height(),w:d.width(),h:d.height()};if(/^nw$/i.test(a)){}else{if(/^ne$/i.test(a)){c=$.extend(c,{x1:c.x1-c.w,x2:c.x2-c.w})}else{if(/^sw$/i.test(a)){c=$.extend(c,{y1:c.y1-c.h,y2:c.y2-c.h})}else{if(/^se$/i.test(a)){c=$.extend(c,{x1:c.x1-c.w,y1:c.y1-c.h,x2:c.x2-c.w,y2:c.y2-c.h})}}}}return c},shiftBy:function(d,c){return{x1:d.x1+c.x1,y1:d.y1+c.y1,x2:d.x2+c.x1,y2:d.y2+c.y1,w:d.w,h:d.h}},overlap:function(d,c){if(d.x2<c.x1){return false}if(d.x1>c.x2){return false}if(d.y2<c.y1){return false}if(d.y1>c.y2){return false}return true},place:function(c){var b=["sw","se","nw","ne"],e="ne",d=App.views.mapView.getBBox(),a=_.map(b,function(f){return{edge:f,bbox:this.shiftBy(this.getBBox(f),d)}},this);_.each(c,function(f){var g=this.shiftBy(f.getBBox(),d);_.each(a,function(h){if(this.overlap(g,h.bbox)){b=_.filter(b,function(i){return(i!==h.edge)})}},this)},this);b.push(e);this.set({edge:_.head(b)})}});ViewWatcher=Backbone.Model.extend({initialize:function(){var b="mapView";var c=/.*pageView=([^&]*).*/.exec(window.location.href);if(c!==null&&c.length>1){b=c[1]}var a=b;if(localStorage.lastView){a=localStorage.lastView}localStorage.lastView=b;this.set({view:b,lastView:a})},viewChanged:function(){var a=this.get("view");var b=this.get("lastView");return(a!==b)}});StudyWatcher=Backbone.Model.extend({initialize:function(){var c="Germanic";var a=/.*study=([^&]*).*/.exec(window.location.href);if(a!==null&&a.length>1){c=a[1]}var b=c;if(localStorage.lastStudy){b=localStorage.lastStudy}localStorage.lastStudy=c;this.set({study:c,lastStudy:b})},studyChanged:function(){var b=this.get("study");var a=this.get("lastStudy");return(b!==a)}});SoundPlayOption=Backbone.Model.extend({initialize:function(){var a=localStorage.playMode;if(!a){a="hover"}this.set({playMode:a});this.on("change:playMode",this.saveMode,this)},saveMode:function(){localStorage.playMode=this.get("playMode")},playOnHover:function(){return this.get("playMode")==="hover"},playOnClick:function(){return this.get("playMode")==="click"}});if(typeof(google)!=="undefined"){Map=Backbone.Model.extend({defaults:{mapOptions:{zoom:2,center:new google.maps.LatLng(54.92,1.875),mapTypeId:google.maps.MapTypeId.TERRAIN,streetViewControl:false,styles:[{featureType:"administrative.country",elementType:"labels",stylers:[{visibility:"off"}]}]},defaultBounds:new google.maps.LatLngBounds(),regionBounds:new google.maps.LatLngBounds(),wordOverlays:[],notAddedWos:0},initialize:function(){this.set($.parseJSON($("div#map_data").text()));this.initRegionBounds();var a=_.map(this.get("transcriptions"),function(b){var c=new WordOverlay(b);c.on("change:added",this.wordOverlayAdded,this);return c},this);this.set({wordOverlays:a,notAddedWos:a.length})},initRegionBounds:function(){_.each(this.get("regionZoom"),function(b){var a=new google.maps.LatLng(b.lat,b.lon);this.get("regionBounds").extend(a)},this)},sortWordOverlays:function(b){if(!/^(ns|sn|we|ew)$/i.test(b)){console.log("Map.sortWordOverlays("+b+"): Invalid direction!");return}var a=_.map(this.get("wordOverlays"),function(c){var d=c.get("position");return[d.lat(),d.lng(),c]});if(/^(we|ew)$/i.test(b)){a=_.map(a,function(c){return[c[1],c[0],c[2]]})}a.sort(function(d,c){return d[0]-c[0]});if(/^(ns|ew)$/i.test(b)){a.reverse()}return _.map(a,_.last)},wordOverlayAdded:function(b){if(!b.get("added")){return}b.off(null,null,this);var e=this.get("notAddedWos")-1;this.set({notAddedWos:e});if(e===0){var a=this;var d=window.setTimeout(function(){window.clearTimeout(d);a.placeWordOverlays()},1000)}this.get("defaultBounds").extend(b.get("position"))},placeWordOverlays:function(){var a=this.sortWordOverlays("ns");_.reduce(a,function(b,c){c.place(_.last(b,2));b.push(c);return b},[],this)}})};if(typeof(google)!=="undefined"){WordOverlayView=ColorCalcView.extend({initialize:function(){this.model.set({view:this});this.model.on("change:edge",this.edgeChanged,this);this.setMap(this.el)},onAdd:function(){var d=document.createElement("div"),b=this.model.get("color");b.opacity/=100;b.color=this.getColorDepth(b.color,b.colorDepth);$(d).addClass("mapAudio","audio").html(this.model.get("content")).css("background-color",b.color).css("opacity",b.opacity);$(".transcription",d).each(function(){var e=$(this).next().get(0);if(e){$(this).on("click mouseover touchstart",function(f){if(f.type==="mouseover"){if(!App.soundPlayOption.playOnHover()){return}}window.App.views.audioLogic.play(e)})}});var c=this.getPanes();c.overlayMouseTarget.appendChild(d);var a=new google.maps.Marker({icon:{fillColor:"#000000",fillOpacity:1,path:google.maps.SymbolPath.CIRCLE,scale:5,strokeWeight:0},map:this.el,position:this.model.get("position"),title:this.model.get("hoverText"),visible:true});this.model.set({div:d,marker:a,added:true})},getPoint:function(){var a=this.model.get("position");return this.getProjection().fromLatLngToDivPixel(a)},draw:function(){var a=this.model.getBBox(),b=this.model.get("div");b.style.left=a.x1+"px";b.style.top=a.y1+"px"},onRemove:function(){this.model.get("div").parentNode.removeChild(this.div);this.model.get("marker").setMap(null);this.model.set({div:null,marker:null})},onScreen:function(){var a=this.model.get("position");return this.el.getBounds().contains(a)},edgeChanged:function(){if(this.model.get("added")){this.draw()}}});WordOverlayView.prototype=_.extend(WordOverlayView.prototype,google.maps.OverlayView.prototype)};SoundPlayOptionView=Backbone.View.extend({initialize:function(){this.model.on("change:playMode",this.render,this);this.render()},events:{"click button":"changeOptions"},changeOptions:function(a){var b=$(a.target).val();if(!b||b==""){b="hover"}this.model.set({playMode:$(a.target).val()})},render:function(){this.$("button").removeClass("btn-inverse").removeAttr("disabled");var a=this.model.get("playMode");if(!a||a==""){a="hover"}this.$('button[value="'+a+'"]').addClass("btn-inverse").attr("disabled","disabled")}});if(typeof(google)!=="undefined"){ColorCalcView=Backbone.View.extend({getColorDepth:function(c,b){var a=b*-2.4+320;return this.getLuminocity(c,a)},getLuminocity:function(d,a){var c=this.splitRgb(d);var b=this.rgbToHsl(c[0],c[1],c[2]);b[2]=a;c=this.hslToRgb(b[0],b[1],b[2]);return this.mergeRgb(c)},splitRgb:function(d){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d),b=[],c;for(c=1;c<4;c++){b.push(parseInt(a[c],16))}return b},mergeRgb:function(a){var d="#",b,e;for(b=0;b<a.length;b++){e=a[b].toString(16);d+=("00"+e).substr(e.length)}return d},hslToRgb:function(i,m,f){var a,j,k;if(m==0){a=j=k=1}else{function e(h,g,b){if(b<0){b+=1}if(b>1){b-=1}if(b<1/6){return h+(g-h)*6*b}if(b<1/2){return g}if(b<2/3){return h+(g-h)*(2/3-b)*6}return h}var c=f<0.5?f*(1+m):f+m-f*m;var d=2*f-c;a=e(d,c,i+1/3);j=e(d,c,i);k=e(d,c,i-1/3)}return[a*255,j*255,k*255]},rgbToHsl:function(a,i,k){a/=255,i/=255,k/=255;var m=Math.max(a,i,k),e=Math.min(a,i,k);var f,n,c=(m+e)/2;if(m==e){f=n=0}else{var j=m-e;n=c>0.5?j/(2-m-e):j/(m+e);switch(m){case a:f=(i-k)/j+(i<k?6:0);break;case i:f=(k-a)/j+2;break;case k:f=(a-i)/j+4;break}f/=6}return[f,n,c]}})};if(typeof(google)!="undefined"){MapView=Backbone.View.extend({events:{"click #map_menu_viewAll":"saveSelection","click #map_menu_viewLast":"loadSelection","click #map_menu_zoomCenter":"centerDefault","click #map_menu_zoomCoreRegion":"centerRegion"},initialize:function(){this.div=document.getElementById("map_canvas");this.map=new google.maps.Map(this.div,this.model.get("mapOptions"));this.render();this.soundControlView=new SoundControlView({el:this.map,model:this});var a=this;$(window).resize(function(){a.adjustCanvasSize()});google.maps.event.addListener(this.map,"zoom_changed",function(){a.model.placeWordOverlays()})},render:function(){this.adjustCanvasSize();var a=this,b=window.setTimeout(function(){a.centerRegion();window.clearTimeout(b)},1000);this.wordOverlayViews=_.map(this.model.get("wordOverlays"),function(c){return new WordOverlayView({el:this.map,model:c})},this)},adjustCanvasSize:function(){var a=$("#map_canvas"),b=a.offset();a.css("height",window.innerHeight-b.top-1+"px");google.maps.event.trigger(this.map,"resize")},centerDefault:function(){this.map.fitBounds(this.model.get("defaultBounds"));$("#map_menu_zoomCenter").addClass("selected");$("#map_menu_zoomCoreRegion").removeClass("selected")},centerRegion:function(){this.map.fitBounds(this.model.get("regionBounds"));$("#map_menu_zoomCoreRegion").addClass("selected");$("#map_menu_zoomCenter").removeClass("selected")},saveSelection:function(){var a=$("div#saveLocation").attr("href");localStorage.maps_userSelection=a},loadSelection:function(a){if(localStorage.maps_userSelection){window.location.href=localStorage.maps_userSelection;a.preventDefault()}},fillPSeq:function(c,b){var a=this.model.sortWordOverlays(c);_.chain(a).filter(function(e){var d=e.get("view");if(e.get("added")&&d){return d.onScreen()}return false}).each(function(d){b.add(d.getAudio())})},getBBox:function(){var a=this.div;var b={x:0,y:0};while(a){b.x+=a.offsetLeft;b.y+=a.offsetTop;a=a.offsetParent}if(document.documentElement&&(document.documentElement.scrollTop||document.documentElement.scrollLeft)){b.x-=document.documentElement.scrollLeft;b.y-=document.documentElement.scrollTop}else{if(document.body&&(document.body.scrollTop||document.body.scrollLeft)){b.x-=document.body.scrollLeft;b.y-=document.body.scrollTop}else{if(window.pageXOffset||window.pageYOffset){b.x-=window.pageXOffset;b.y-=window.pageYOffset}}}a=$(this.div);return{x1:b.x,y1:b.y,x2:b.x+a.width(),y2:b.y+a.height(),w:a.width(),h:a.height()}}})};HideLinks=Backbone.View.extend({initialize:function(){this.content=$("#contentArea");this.links={};var a=this;$("a.hidelink").click(function(){a.click($(this))}).each(function(){var c=$(this),b=c.data("name");a.links[b]=c});this.loadStates();this.render()},toggleChevron:function(a){if(a.hasClass("icon-chevron-right")){a.addClass("icon-chevron-left").removeClass("icon-chevron-right")}else{if(a.hasClass("icon-chevron-left")){a.addClass("icon-chevron-right").removeClass("icon-chevron-left")}}},getSpan:function(b){for(var a=1;a<=12;a++){if(b.hasClass("span"+a)){return a}}return 0},deltaSpan:function(a,c){var b=this.getSpan(a);a.removeClass("span"+b).addClass("span"+(b+c))},click:function(a){this.toggleChevron(a.find("i"));var b=$(a.data("target")),c=this.getSpan(b);if(b.is(":visible")){b.hide();this.deltaSpan(this.content,c)}else{b.show();this.deltaSpan(this.content,-c)}this.saveState(a,!b.is(":visible"));if(window.App.views.mapView){window.App.views.mapView.adjustCanvasSize()}},saveState:function(b,c){var a=this.storageKey(b.data("name"));localStorage[a]=c},loadStates:function(){_.each(this.links,function(a,b){var c=this.storageKey(b);if(localStorage[c]==="true"){a.trigger("click")}},this)},storageKey:function(b){var a=this.model.get("view");return"HideLinks_toggle_"+a+"_"+b},render:function(){var a=this.model.get("view");if(a==="whoAreWe"){_.each(this.links,function(b,c){var d=this.storageKey(c);if(!localStorage[d]){b.trigger("click")}},this)}}});SoundControlView=Backbone.View.extend({initialize:function(){var c=document.createElement("div"),b=$("#map_play_directions"),a=this.model;$(c).attr("id","SoundControlView").html(b.html()).find("i").each(function(g,l){var k=$(l);var j=k.attr("data-direction");var f=new PlaySequence(k);var d=f.showPlay;f.showPlay=function(){this.clear();d.call(this)};var h=f.showPause;f.showPause=function(){a.fillPSeq(j,this);$("#SoundControlView > i").each(function(){if($(this).hasClass("icon-pause")){$(this).trigger("click")}});h.call(this)}});this.el.controls[google.maps.ControlPosition.TOP_LEFT].push(c);b.remove()}});var _gaq=_gaq||[];function initLogging(){_gaq.push(["_setAccount","UA-28740209-1"]);(function(){var h=document.createElement("script");h.type="text/javascript";h.async=true;h.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(h,g)})();var b=$("div#saveLocation").attr("href");var c={study:/.*study=([^&]*).*/,viewType:/.*pageView=([^&]*).*/,language:/.*languages=([^&]*).*/,word:/.*words=([^&]*).*/};if(c.study.test(b)){var d=c.study.exec(b)[1];_gaq.push(["_setCustomVar",1,"Study",d,3])}var a="";if(c.viewType.test(b)){a=c.viewType.exec(b)[1];_gaq.push(["_setCustomVar",2,"ViewType",a,3])}if(c.language.test(b)&&a!="multiWordView"){var f=c.language.exec(b)[1];_gaq.push(["_setCustomVar",3,"Language",f,3])}if(c.word.test(b)&&a!="multiWordView"){var e=c.word.exec(b)[1];_gaq.push(["_setCustomVar",4,"Word",e,3])}_gaq.push(["_trackPageview"])};function PlaySequence(b){this.clear();this.target=b;var a=this;b.click(function(){a.togglePlay()})}PlaySequence.prototype.add=function(a){this.sequence.push(a)};PlaySequence.prototype.clear=function(){this.next=0;this.playing=false;this.sequence=[]};PlaySequence.prototype.play=function(){this.playing=true;var a=this;window.App.views.audioLogic.setPlayFinished(function(){a._play()});this._play()};PlaySequence.prototype._play=function(){if(this.next>=this.sequence.length){this.next=0;this.playing=false;this.showPlay()}if(!this.playing){return}var a=this.sequence[this.next];this.next++;window.App.views.audioLogic.play(a)};PlaySequence.prototype.stop=function(){this.playing=false};PlaySequence.prototype.rotate=function(b,a){if(b.hasClass("rotate90")){b.addClass("rotate180").removeClass("rotate90")}else{if(b.hasClass("rotate180")){b.addClass("rotate270").removeClass("rotate180")}else{if(b.hasClass("rotate270")){b.removeClass("rotate270")}else{b.addClass("rotate90")}}}if(a){this.rotate(b);this.rotate(b)}};PlaySequence.prototype.showPlay=function(){if(this.target.hasClass("icon-eject")){return}this.target.addClass("icon-eject").removeClass("icon-pause");this.rotate(this.target)};PlaySequence.prototype.showPause=function(){if(this.target.hasClass("icon-pause")){return}this.target.addClass("icon-pause").removeClass("icon-eject");this.rotate(this.target,true)};PlaySequence.prototype.togglePlay=function(){if(this.target.hasClass("icon-eject")){this.showPause();this.play()}else{this.showPlay();this.stop()}};var initPlaySequence=function(){var a=/.*pageView=([^&]*).*/;var c=a.exec($("div#saveLocation").attr("href"))[1];switch(c){case"singleWordView":var b=new PlaySequence($("#wordHeadline_playAll"));$("#singleWordTable audio").each(function(){b.add(this)});break;case"multiWordView":$(".multitablePlayWe").each(function(){var d=new PlaySequence($(this));$(this).closest("tr").find(".transcription audio").each(function(){d.add(this)})});$(".multitablePlayNs").each(function(){var e=new PlaySequence($(this));var d=$(this).closest("th").index();$("#multitable tr").each(function(){var f=$("td:first-child",this).is(".regionCell");var g=f?d+1:d;$("td:nth-child("+g+") audio",this).each(function(){e.add(this)})})});break;case"multiViewTransposed":$(".multitablePlayWe").each(function(){var d=new PlaySequence($(this));$(this).closest("tr").find(".transcription audio").each(function(){d.add(this)})});$(".multitablePlayNs").each(function(){var e=new PlaySequence($(this));var d=$(this).closest("th").index();if($("#multitabletrans .regionCell").length===0){d++}$("#multitabletrans tr").each(function(){var f=$("td:first-child",this).is(".regionCell");var g=f?d+1:d;$("td:nth-child("+g+") audio",this).each(function(){e.add(this)})})});break}};$(function(){window.App={studyWatcher:new StudyWatcher(),soundPlayOption:new SoundPlayOption(),viewWatcher:new ViewWatcher(),views:{}};if(typeof(Map)!=="undefined"){window.App.map=new Map()}window.App.views.hideLinks=new HideLinks({el:null,model:window.App.viewWatcher});window.App.views.soundPlayOptionView=new SoundPlayOptionView({el:$("#topmenuSoundOptions"),model:window.App.soundPlayOption});window.App.views.audioLogic=new AudioLogic();if(typeof(MapView)!=="undefined"){window.App.views.mapView=new MapView({el:$("#contentArea"),model:window.App.map})}});function singleLanguageView(){var d=$("#languageTable");if(d.length===0){return}var e=new PlaySequence($("#language_playAll"));var b=function(){e.clear();$("#languageTable td:visible audio").each(function(){e.add(this)})};var c=Math.floor(d.width()/100);var a=function(){var g=d.find("tbody").addClass("old");d.append('<tbody class="new"><tr></tr></tbody>');var f=d.find("tbody.new");var h=0;g.find("td").each(function(){if(h===c){f.append("<tr></tr>");h=0}if($(this).is(":visible")){h++}f.find("tr").last().append(this)});g.remove();f.removeClass("new");b()};a();d.on("redraw",a)};function wordlistfilter(){function a(q){var j="iyɨʉɯuɪʏʊeøɘɵɤoəɛœɜɞʌɔæɐaɶɑɒɚɝ";var u="˥˦˧˨˩↓↑↗↘̋́̄̀̏᷈᷅᷄̂̌ˈˌːˑ̆|‖.‿̃˔̟̹̜̠̝˕˞̞̰̤̥̈̽";var k="pbtdʈɖɟɟkɡqɢʔmɱnɳɲŋɴʙrʀⱱɾɽɸβfvθðszʃʒʂʐçʝxɣχʁħʕhɦɬɮʋɹɻjɰlɭʎʟɫ";var p="ʼɓɗʄɠʛʘǀǃǂǁʍʡʬ¡wɕʭǃ¡ɥʑʪʜɺʫʢɧʩ";var l="ː";var t="mɱnɳɲŋɴ";var n="̃";var r="ɸβfvθðszʃʒʂʐçʝxɣχʁħʕhɦɬɮ";var o="ɕʑɧ";var s="pbtdʈɖɟɟkɡqɢʔ";var m="ɓɗʄɠʛʘǀǃǂǁ";q=q.replace(/V/g,"["+j+"]["+u+"]*");q=q.replace(/C/g,"["+k+p+l+"]");q=q.replace(/N/g,"["+t+n+"]");q=q.replace(/FL/g,"[ɬɮʋɹɻjɰ]");q=q.replace(/R/g,"[ʋɹɻʀʁχrɾⱱ˞]");q=q.replace(/A/g,"(tʃ|ts|tθ|ʈʂ|dʒ|dz|dð|ɖʐ|pf|bβ|kx|ɡɣ)");q=q.replace(/F/g,"["+r+o+"]");q=q.replace(/(S|T)/g,"["+s+m+"]");q=q.toLowerCase();return q}if(window.App.studyWatcher.studyChanged()||window.App.viewWatcher.viewChanged()){$.cookie("wordlistfilter_content",null);$.cookie("wordlistfilter_inputId",null);$.cookie("wordlistfilter_selectedId",null)}else{$($.cookie("wordlistfilter_selectedId")).addClass("selected");$($.cookie("wordlistfilter_inputId")).val($.cookie("wordlistfilter_content"))}function g(j){if(j!=""){return}$("#FilterSpelling").removeClass("selected");$("#FilterPhonetic").removeClass("selected");$.cookie("wordlistfilter_selectedId",null);$.cookie("wordlistfilter_inputId",null);$.cookie("wordlistfilter_content",null)}var e=($("#languageTable").length>0);var i=function(j){var k=$("#languageTable td.transcription").map(function(m,n){var l={target:$(n)};if(j){l.text=$("div.transcription",n).text()}else{l.text=$(".color-word",n).text()}return l});return k};function d(){var k=$("ul.wordList li:visible").size();$("#FilterFoundMultiWords").text(k);if(k===0){var j=$("#PhoneticFilter");if(j.val()===""){j=$("#SpellingFilter")}if(j.val()===""){return}j.addClass("filterempty")}else{$("#PhoneticFilter, #SpellingFilter").removeClass("filterempty")}}function b(k,j){j=j.replace(/^#/,"^");j=j.replace(/#$/,"$");$(k).each(function(l,n){var m=n.text.toLowerCase();if(m.search(j)>=0){n.target.show()}else{n.target.hide()}});d()}function h(){$("#PhoneticFilter").val("");$("#FilterPhonetic").removeClass("selected");$("#FilterSpelling").addClass("selected");var k=$("#SpellingFilter").val().toLowerCase();$.cookie("wordlistfilter_selectedId","#FilterSpelling");$.cookie("wordlistfilter_inputId","#SpellingFilter");$.cookie("wordlistfilter_content",k);var j=$("ul.wordList .color-word").map(function(l,m){return{text:$(m).text(),target:$(m).closest("li")}});b(j,k);if(e){b(i(false),k);$("#languageTable").trigger("redraw")}g(k)}$("#SpellingFilter").keyup(h);function c(){$("#SpellingFilter").val("");$("#FilterSpelling").removeClass("selected");$("#FilterPhonetic").addClass("selected");var k=$("#PhoneticFilter").val();$.cookie("wordlistfilter_selectedId","#FilterPhonetic");$.cookie("wordlistfilter_inputId","#PhoneticFilter");$.cookie("wordlistfilter_content",k);var j=$("ul.wordList .p50:nth-child(2)").map(function(l,n){var m=$(n).text();m=m.match(/\[(.*)\]/)[1];return{text:m,target:$(n).closest("li")}});b(j,a(k));if(e){b(i(true),k);$("#languageTable").trigger("redraw")}g(k)}$("#PhoneticFilter").keyup(c);var f=function(j){var l="";$("ul.wordList li:visible").each(function(){if($(this).parent().hasClass("selected")){return}l+=$(".color-word",this).attr("data-canonicalname")+","});l="words="+l;var k=$("div#saveLocation").attr("href");if(k.search("words=")>0){if(j===true){k=k.replace("words=",l)}else{k=k.replace(/words=[^&]*/,l.substring(0,l.length-1))}}else{k+="&"+l.substring(0,l.length-1)}window.location=k};$("#FilterAddMultiWords").click(function(){f(true)});$("#FilterRefreshMultiWords").click(function(){f(false)});if($("#SpellingFilter").val()!=""){h()}if($("#PhoneticFilter").val()!=""){c()}d()};$(document).ready(function(){initPlaySequence();singleLanguageView();wordlistfilter();initLogging();initScroll();initIpaKeyboard();$("*[data-href]").click(function(){window.location.href=$(this).attr("data-href")});$("#wordlistfilter select").change(function(){window.location.href=$("option:selected",this).attr("data-href")})});